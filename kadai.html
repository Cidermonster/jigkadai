<html>
        <link href="./style4.css" rel="stylesheet" type="text/css">
<div id="header">
        <p><h1 align="center">マインスイーパー</h1></p>
</div>
<head>
<title>マインスイーパー</title>
<script language="JavaScript">

var bomb;
stage = new Array(100);
stage_blank = new Array(100);
stage_X = new Array(10);
stage_Y = new Array(10);
touch = new Array(100);
var gameover = 0;
        
function gcnt(x,y){
        tcnt = 0;
        if(x>0){
                Q = (x-1)+10*y;
                if(stage[Q] == 99){
                        tcnt++;
                }
                if(y>0){
                        Q = (x-1)+10*(y-1);
                        if(stage[Q] == 99){
                                tcnt++;
                        }
                }
                if(y<9){
                        Q = (x-1)+10*(y+1);
                        if(stage[Q] == 99){
                                tcnt++;
                        }
                }
        }
        if(x<9){
                Q = (x+1)+10*y;
                if(stage[Q] == 99){
                        tcnt++;
                }
                if(y>0){
                        Q = (x+1)+10*(y-1);
                        if(stage[Q] == 99){
                                tcnt++;
                        }
                }
                if(y<9){
                        Q = (x+1)+10*(y+1);
                        if(stage[Q] == 99){
                                tcnt++;
                        }
                }
        }
        if(y>0){
                Q = x+10*(y+1);
                if(stage[Q] == 99){
                        tcnt++;
                }
        }
        if(y<9){
                Q = x+10*(y-1);
                if(stage[Q] == 99){
                        tcnt++;
                }
        }
        return (tcnt);
}

function Make_map(){
        for(i=0;i<100;i++){
                stage[i] = 0;
                stage_blank[i] = 0;
                touch[i] = 0;
                document.images[i].src = "Reset_data.jpg";
        }

        bomb = Math.round(Math.random() * 5)+10;
        document.ms.cnt.value=bomb;
        cnt = 0;
        while(1){
                r = Math.round(Math.random() * 100);
                if(stage[r] == 0){
                        stage[r] = 99;
                        cnt++;
                        if(cnt == bomb){
                                break;
                        }
                }
        }

        for(x=0;x<10;x++){
                for(y=0;y<10;y++){
                        Q = x+10*y;
                        if(stage[Q] != 99){
                                cnt = gcnt(x,y);
                                stage[Q] = cnt;
                        }
                }
        }
        gameover = 0;
}

function Open_bomb(){
        for(i=0;i<100;i++){
                if((touch[i] == 1)&&(stage[i] != 99)){
                        document.images[i].src = "100.jpg";
                }
                if(stage[i] == 99){
                        document.images[i].src = "99.jpg";
                }
        }
}

function Open_Stage(x,y){
        cnt1 = 0;
        cnt2 = 1;
        stage_X = x;
        stage_Y = y;
        Q = x+10*y;
        stage_blank[Q] = 1;
        blank_data = stage[Q]+".jpg";
        document.images[Q].src = blank_data;
        if(stage[Q] == 0){
                Click_Stage();
        }
}

function check(x,y){
        Q = x+10*y;
        if(stage_blank[Q] == 1){
                return;
        }
        if(stage[Q] == 0){
                stage_X[cnt2] = x;
                stage_Y[cnt2] = y;
                cnt2++;
        }
        if(stage[Q] != 99){
                stage_blank[Q] = 1;
                blank_data = stage[Q]+".jpg";
                document.images[Q].src = blank_data;
        }
}

function Click_Stage(x,y){
        while(1){
                loop = cnt1;
                cnt1 = cnt2;
                for(i=loop;i<cnt1;i++){
                        if(stage_X[i]>0){
                                check(stage_X[i]-1,stage_Y[i]);
                        }
                        if(stage_X[i]<9){
                                check(stage_X[i]+1,stage_Y[i]);
                        }
                        if(stage_Y[i]>0){
                                check(stage_X[i],stage_Y[i]-1);
                        }
                        if(stage_Y[i]<9){
                                check(stage_X[i],stage_Y[i]+1);
                        }
                }
                if(cnt1 == cnt2){
                        break;
                }
        }
}

function Set(x,y){
        if(gameover == 1){
                alert("リセットしてください.");
        }
        Q = x+10*y;
        if(stage_blank[Q] == 1){
                return;
        }
        Open_Stage(x,y);

        if(stage[Q] == 99){
                alert("爆弾を押しました.あなたの敗北となります.");
                gameover = 1;
                Open_bomb();
                return;
        }

        cnt = 0;
        for(i=0;i<100;i++){
                if(stage_blank[i] == 0){
                        cnt++;
                }
        }
        if(cnt == bomb){
                alert("爆弾を全て見つけました!クリアとなります.");
                gameover = 1;
                Open_bomb();
                return;
        }
}

function change_data(x,y){
        Q = x+10*y;
        if(stage_blank[Q] == 1){
                return;
        }
        if(touch[Q] == 1){
                document.images[Q].src = "Reset_data.jpg";
                touch[Q] = 0;
                return;
        }
        if(touch[Q] == 0){
                document.images[Q].src = "99.jpg";
                touch[Q] = 1;
        }
}

</script>
</head>
<body text="#000000" onLoad=Make_map()>
<div align="center">
        <table border="2">
                <tbody>
                <tr>
                        <td>
                                <script language="JavaScript">
                                        
                                        <!--
for(i=0;i<10;i++){
        for(j=0;j<10;j++){
                document.write('<a href=JavaScript:Set('+j+','+i+')><img src=Reset_data.jpg oncontextmenu="change_data(',j,',',i,');return false" border=0 width=32 height=32></a>');
        }
        document.write("<br>\n");
}
                                        //-->
                                </script>
                        </td>
                        </tr>
                </tbody>
        </table>
        <form name=ms>
                地雷の個数:
                <input type=text value" " alt" " name="cnt" size="5">
                個
                <br>
                右クリックで旗を置けます
                <br>
                <hr>
                <input type="button" value="Reset" onClick="Make_map()">
                <hr>
        </form>
        <br>
</div>
</body>
</html>
